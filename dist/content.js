(()=>{"use strict";function e(){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();t.connect(n),n.connect(e.destination),t.type="sine",t.frequency.setValueAtTime(440,e.currentTime),n.gain.setValueAtTime(.1,e.currentTime),t.start(),t.stop(e.currentTime+.2)}let t={soundEnabled:!0,desktopEnabled:!0};function n(){let n=null;const s=new MutationObserver((s=>{for(const o of s){if("childList"===o.type&&o.addedNodes.length>0){const e=o.addedNodes[o.addedNodes.length-1];e instanceof HTMLElement&&e.classList.contains("markdown")&&(n=e)}if("attributes"===o.type&&o.target instanceof HTMLElement&&"class"===o.attributeName){const s=o.target;s!==n||!s.classList.contains("markdown")||s.classList.contains("result-streaming")||s.classList.contains("notified")||setTimeout((()=>{if(!s.classList.contains("result-streaming")){s.classList.add("notified");const o=s.textContent?.slice(0,100)??"New response from ChatGPT";console.log("🤖 ChatGPT応答が完了しました:",{timestamp:(new Date).toISOString(),preview:o,notificationSettings:{sound:t.soundEnabled,desktop:t.desktopEnabled}}),t.desktopEnabled&&chrome.runtime.sendMessage({type:"SHOW_NOTIFICATION",text:o}),t.soundEnabled&&e(),n=null}}),50)}}})),o=document.querySelector("main");o&&(s.observe(o,{childList:!0,subtree:!0}),console.log("🔍 ChatGPTの応答監視を開始しました"))}chrome.storage.sync.get(["soundEnabled","desktopEnabled"],(e=>{t={soundEnabled:e.soundEnabled??!0,desktopEnabled:e.desktopEnabled??!0}})),chrome.storage.onChanged.addListener((e=>{e.soundEnabled&&(t.soundEnabled=e.soundEnabled.newValue),e.desktopEnabled&&(t.desktopEnabled=e.desktopEnabled.newValue)})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()})();